(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{1458:function(e,t,n){e.exports={vertical:"Scrollbar__vertical",background:"Scrollbar__background",handle_vertical:"Scrollbar__handle_vertical"}},1460:function(e,t,n){e.exports={not_this_step:"Terminal__not_this_step",root:"Terminal__root",term:"Terminal__term","terminal-text":"Terminal__terminal-text",scroll:"Terminal__scroll",term_hide:"Terminal__term_hide",term_show:"Terminal__term_show"}},1494:function(e,t,n){"use strict";n.r(t);var r=n(12),i=n.n(r),o=n(0),s=n.n(o),a=(n(2),n(7)),l=n(3),c=n(1),u=n.n(c),_=(n(1460),n(1171)),p=n.n(_),m=n(43),f=n(124),h=n(68);n(1458);function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var b={"./Scrollbar.scss":{vertical:"Scrollbar__vertical",background:"Scrollbar__background",handle_vertical:"Scrollbar__handle_vertical"}};function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function k(e){return e.charAt(0).toUpperCase()+e.substr(1)}var O={orientation:{horizontal:{dimension:"width",direction:"left",coordinate:"x"},vertical:{dimension:"height",direction:"top",coordinate:"y"}}},x=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return z(g(n=function(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?g(e):t}(this,(e=y(t)).call.apply(e,[this].concat(i)))),"state",{slider_size:0}),z(g(n),"get_sizes",function(){var e=n.props,t=e.max,r=e.min,i=n.state.slider_size,o=t-r,s=30;if(0===i)return{limit:0,grab:0,handle_size:s};return{limit:i-(s=0===o?i:Math.max(i/o,30)),grab:s/2,handle_size:s}}),z(g(n),"handleSliderMouseDown",function(e){var t=n.props.onChange;if(t){var r=n.position(e);t&&t(r)}}),z(g(n),"handleKnobMouseDown",function(){document.addEventListener("mousemove",n.handleDrag),document.addEventListener("mouseup",n.handleDragEnd)}),z(g(n),"handleDrag",function(e){var t=n.props.onChange;if(t){var r=n.position(e);t&&t(r)}}),z(g(n),"handleDragEnd",function(){document.removeEventListener("mousemove",n.handleDrag),document.removeEventListener("mouseup",n.handleDragEnd)}),z(g(n),"handleNoop",function(e){e.stopPropagation(),e.preventDefault()}),z(g(n),"getPositionFromValue",function(e){var t=n.get_sizes().limit,r=n.props,i=r.min,o=r.max;if(i===o)return 0;var s=(e-i)/(o-i);return Math.round(s*t)}),z(g(n),"getValueFromPosition",function(e){var t=n.get_sizes().limit,r=n.props,i=r.orientation,o=r.min,s=r.max,a=r.step,l=function(e,t,n){return e<t?t:e>n?n:e}(e,0,t)/(t||1);return"horizontal"===i?a*Math.round(l*(s-o)/a)+o:s-a*Math.round(l*(s-o)/a)}),z(g(n),"position",function(e){if(null==n._slider)return 0;var t=n.get_sizes().grab,r=n.props.orientation,i=n._slider,o=O.orientation[r].coordinate,s=O.orientation[r].direction,a=e["client"+k(o)]-i.getBoundingClientRect()[s]-t;return n.getValueFromPosition(a)}),z(g(n),"coordinates",function(e){var t=n.get_sizes(),r=t.limit,i=t.grab,o=n.props.orientation,s=n.getValueFromPosition(e),a=n.getPositionFromValue(s);return{fill:"horizontal"===o?a+i:r-a+i,handle:a}}),z(g(n),"set_slider",function(e){n._slider=e,null!=e&&n.resized()}),z(g(n),"resized",function(){if(null!=n._slider){var e=n.props.orientation,t=k(O.orientation[e].dimension);n.setState({slider_size:n._slider["offset"+t]})}}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,s.a.PureComponent),function(e,t,n){t&&v(e.prototype,t),n&&v(e,n)}(t,[{key:"render",value:function(){var e,t=this.get_sizes().handle_size,n=this.props,r=n.value,o=n.orientation,a=O.orientation[o].dimension,l=O.orientation[o].direction,c=this.getPositionFromValue(r),u=this.coordinates(c).handle+4,_=t-4-4,p=(z(e={},l,"".concat(u,"px")),z(e,a,"".concat(_,"px")),e);return s.a.createElement("div",{ref:this.set_slider,onMouseDown:this.handleSliderMouseDown,onClick:this.handleNoop,className:i()(o,b)},s.a.createElement(f.a,{onResize:this.resized}),s.a.createElement("div",{className:"Scrollbar__background"}),s.a.createElement("button",{onMouseDown:this.handleKnobMouseDown,onClick:this.handleNoop,style:p,className:i()("handle_"+o,b)}))}}]),t}();z(x,"defaultProps",{min:0,max:100,step:1,value:0,orientation:"vertical"}),x.displayName="Scrollbar";var T=x,S=n(203),j=n(20),P=n(14);function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.d(t,"selectors",function(){return W}),n.d(t,"actions",function(){return I}),n.d(t,"Terminal",function(){return K});var M={"./Terminal.scss":{root:"Terminal__root",term:"Terminal__term","terminal-text":"Terminal__terminal-text",scroll:"Terminal__scroll",not_this_step:"Terminal__not_this_step",term_hide:"Terminal__term_hide",term_show:"Terminal__term_show","terminal-cursor":"Terminal__terminal-cursor"}};function D(){return(D=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function F(e,t){return(F=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var W=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V(n,!0).forEach(function(t){L(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},S.b,{current_step_index:P.c.current_step_index,current_mission_id:function(e){return j.d.mission_info(e).id}}),I=S.a,A=Object(l.createStructuredSelector)(W),K=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return L(R(n=function(e,t){return!t||"object"!==E(t)&&"function"!=typeof t?R(e):t}(this,(e=C(t)).call.apply(e,[this].concat(i)))),"state",{slider_props:{value:0,min:0},reinitilizing:!1}),L(R(n),"cleanup_terminal",function(){n._terminal&&(n._terminal.destroy(),n._terminal=null)}),L(R(n),"is_this_step",function(){return n.props.for_project||n.props.terminal_step_index===n.props.current_step_index}),L(R(n),"create_terminal",function(e){if(n._terminal=new e.Term({cols:e.size.cols,rows:e.size.rows,useStyle:!1,screenKeys:!0,useMouse:!1}),n._terminal.on("data",e.send_data),n.update_cli_size(e),n.props.for_project){window.setTimeout(function(){return e.send_data("clear\n")},500)}}),L(R(n),"get_terminal_lines",function(){var e=n._terminal.lines,t=u.a.map(e,function(e){return u.a.trim(u.a.map(e,function(e){return e[1]}).join(""))});return u.a.filter(t,function(e){return e.length})}),L(R(n),"get_info_for_check",function(){var e=n.get_terminal_lines(),t=e.slice(0,-1),r=u.a.findLastIndex(t,function(e){return u.a.includes(e,"$")});if(-1===r)return"";var i=e.slice(r);return i=i.join("\r\n")}),L(R(n),"check_for_try_answer",function(e){if(null!=n._terminal&&!n.props.answer_check.success&&u.a.endsWith(u.a.trim(e),"$")){var t=n.get_info_for_check();""!==t&&n.props.check_answer(t)}}),L(R(n),"onResize",function(){return n.update_cli_size()}),L(R(n),"update_cli_size",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.props;if(n._terminal&&n._sizer){var t=n.get_sizer_size(),r=n.get_box_size(),i=Math.floor(r.height/t.height),o=Math.floor(r.width/t.width);o=Math.min(o,80),o=Math.max(o,1),i=Math.max(i,1),(i=Math.min(i,30))===e.rows&&o===e.cols||e.resize({cols:o,rows:i})}}),L(R(n),"save_sizer_ref",function(e){n._sizer=e}),L(R(n),"save_box_ref",function(e){n._box=e}),L(R(n),"scroll_terminal",function(e){n._terminal.scrollDisp(-e-n._terminal.ydisp),n.setState({slider_props:{min:n.state.slider_props.min,value:e}})}),L(R(n),"possible_update_slider",function(){if(null!=n._terminal){var e=n._terminal,t=e.ydisp,r=e.ybase,i=n.state.slider_props,o=i.min;-t===i.value&&-r===o||n.setState({slider_props:{min:-r,value:-t}})}}),L(R(n),"term_ref",function(e){null!=n._terminal&&null!=e&&(n._terminal.open(e),n.update_cli_size())}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&F(e,t)}(t,s.a.PureComponent),function(e,t,n){t&&N(e.prototype,t),n&&N(e,n)}(t,[{key:"componentDidMount",value:function(){this.props.listen_for_terminal(),this.possibly_setup_socket(this.props),this.props.connected&&this.create_terminal(this.props)}},{key:"componentWillReceiveProps",value:function(e){this.possibly_update_term(e),e.size!==this.props.size&&this.resize_term(e.size),e.current_step_index-1===e.terminal_step_index&&e.move_forward(),e.connected&&!this.props.connected&&this.create_terminal(e),!e.connected&&this.props.connected?e.connection_info!==this.props.connection_info?(this.props.disconnect_socket(),this.possibly_setup_socket(e)):this.reset_prompt():this.possibly_setup_socket(e)}},{key:"componentWillUnmount",value:function(){console.log("Terminal Unmounted"),this.cleanup_terminal()}},{key:"possibly_update_term",value:function(e){if(e.latest_data!==this.props.latest_data&&this._terminal){var t=e.latest_data.data;if(u.a.isEmpty(t))return;this._terminal.write(t),this.check_for_try_answer(t),this.possible_update_slider(t)}}},{key:"reset_prompt",value:function(){var e=this,t=this.props.failed_to_connect?"Something with the network went wrong, please try again":"You can only have one command line terminal connected at a time. If this is your current mission, please click reconnect to connect the terminal.";return this.props.dq_alert({title:"Network Issues",text:t,type:"warning",confirmButtonText:"Reconnect"}).then(function(){e.setState({reinitilizing:!0}),e.props.reset_terminal(e.props.current_step_index)}).catch(u.a.noop)}},{key:"possibly_setup_socket",value:function(e){null!=e.connection_info&&(e.connected&&e.connection_info.mission_id===e.current_mission_id||e.connected||(e.connection_info.mission_id===e.current_mission_id?e.setup_socket():this.reset_prompt()))}},{key:"get_sizer_size",value:function(){return{width:(this._sizer.clientWidth||"Terminal".length)/"Terminal".length,height:(this._sizer.clientHeight||1)/1}}},{key:"get_box_size",value:function(){return{width:this._box.clientWidth||0,height:this._box.clientHeight||0}}},{key:"resize_term",value:function(e){if(null!=this._terminal){var t=e.cols,n=e.rows;this._terminal.resize(t,n)}}},{key:"renderSlider",value:function(){return this._terminal&&this.is_this_step()?s.a.createElement("div",{className:"Terminal__scroll"},s.a.createElement(T,D({orientation:"vertical"},this.state.slider_props,{max:0,step:1,onChange:this.scroll_terminal}))):null}},{key:"renderMessages",value:function(){if(!this.is_this_step())return s.a.createElement("div",{className:"Terminal__not_this_step"},"To reset your terminal state for this screen, click the restore button below. Otherwise, click next to move to your active terminal session.");if(!this.props.connected){var e=this.state.reinitilizing?"Network issues reconnecting":"Initializing the command line terminal";return s.a.createElement(m.a,{message:e})}return null}},{key:"renderTerm",value:function(){var e=this.is_this_step()&&this._terminal?"term_show":"term_hide";return this.props.connected?s.a.createElement("div",{ref:this.term_ref,className:i()(e,M)}):null}},{key:"render",value:function(){return s.a.createElement("div",{className:"Terminal__root"},s.a.createElement("div",{ref:this.save_box_ref,className:"code "+this.props.className+" Terminal__term"},s.a.createElement(this.props.ResizeSensor,{onResize:this.onResize}),s.a.createElement("div",{ref:this.save_sizer_ref,className:"Terminal__terminal-text"},"Terminal"),this.renderMessages(),this.renderTerm(),this.renderSlider()))}}]),t}();L(K,"defaultProps",{Term:p.a,ResizeSensor:f.a,dq_alert:h.a,className:""}),K.displayName="Terminal";t.default=Object(a.b)(A,I)(K)}}]);
//# sourceMappingURL=Terminal.ece56588f66aebd8beed.js.map